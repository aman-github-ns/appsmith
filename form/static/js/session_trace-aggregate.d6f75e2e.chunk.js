"use strict";(self.webpackChunkappsmith=self.webpackChunkappsmith||[]).push([[193],{23641:function(e,t,n){var r;n.d(t,{m:function(){return i}});var s=new Promise((function(e){r=e})),i=Object.freeze({onReplayReady:r,sessionReplayInitialized:s})},56777:function(e,t,n){n.d(t,{o:function(){return m}});var r=n(93433),s=n(15671),i=n(43144),a=n(82963),o=n(78814),u=n(61120),c=n(97326),l=n(60136),h=n(75284),f=n(9831),d=n(19198),v=n(99712),p=n(73198);var m=function(e){function t(e,n,r){var i,l,h,f,m;return(0,s.Z)(this,t),h=this,f=t,m=[r],f=(0,u.Z)(f),(l=(0,a.Z)(h,(0,o.Z)()?Reflect.construct(f,m||[],(0,u.Z)(h).constructor):f.apply(h,m))).endpoint=e,l.opts=n||{},l.started=!1,l.timeoutHandle=null,l.aborted=!1,l.harvest=new d.M(l.sharedContext),(0,v.L)(l.unload.bind((0,c.Z)(l))),null===(i=l.sharedContext)||void 0===i||i.ee.on(p.wO.RESET,(function(){return l.runHarvest({forceNoRetry:!0})})),l}return(0,l.Z)(t,e),(0,i.Z)(t,[{key:"unload",value:function(){this.aborted||(this.opts.onUnload&&this.opts.onUnload(),this.runHarvest({unload:!0}))}},{key:"startTimer",value:function(e,t){this.interval=e,this.started=!0,this.scheduleHarvest(null!=t?t:this.interval)}},{key:"stopTimer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.aborted=e,this.started=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}},{key:"scheduleHarvest",value:function(e,t){var n=this;this.timeoutHandle||(null==e&&(e=this.interval),this.timeoutHandle=setTimeout((function(){n.timeoutHandle=null,n.runHarvest(t)}),1e3*e))}},{key:"runHarvest",value:function(e){var t=this;if(!this.aborted){var n,s,i=function(n){null!==e&&void 0!==e&&e.forceNoRetry&&(n.retry=!1),t.onHarvestFinished(e,n)},a=[];if(this.opts.getPayload){if(!(n=h.qD({isFinalHarvest:null===e||void 0===e?void 0:e.unload})))return!1;var o=!(null!==e&&void 0!==e&&e.unload)&&n===h.Be;if(!(s=this.opts.getPayload({retry:o,opts:e})))return void(this.started&&this.scheduleHarvest());s="[object Array]"===Object.prototype.toString.call(s)?s:[s],a.push.apply(a,(0,r.Z)(s))}var u=function(e){return t.harvest.sendX(e)};a.length?u=this.opts.raw?function(e){return t.harvest._send(e)}:function(e){return t.harvest.send(e)}:a.push(void 0),a.forEach((function(r){u({endpoint:t.endpoint,payload:r,opts:e,submitMethod:n,cbFinished:i,customUrl:t.opts.customUrl,raw:t.opts.raw})})),this.started&&this.scheduleHarvest()}}},{key:"onHarvestFinished",value:function(e,t){if(this.opts.onFinished&&this.opts.onFinished(t),t.sent&&t.retry){var n=t.delay||this.opts.retryDelay;this.started&&n?(clearTimeout(this.timeoutHandle),this.timeoutHandle=null,this.scheduleHarvest(n,e)):!this.started&&n&&this.scheduleHarvest(n,e)}}}]),t}(f.w)},99712:function(e,t,n){n.d(t,{L:function(){return u}});var r=n(37762),s=n(98841),i=n(63711),a=n(73087);if(i.v6){i._A.cleanupTasks=[];var o=i._A.close;i._A.close=function(){var e,t=(0,r.Z)(i._A.cleanupTasks);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(n){t.e(n)}finally{t.f()}o()}}function u(e){i.il?((0,a.N)(e,!0),(0,s.bP)("pagehide",e)):i.v6&&i._A.cleanupTasks.push(e)}},55302:function(e,t,n){n.r(t),n.d(t,{Aggregate:function(){return G}});var r=n(1413),s=n(74165),i=n(15861),a=n(29439),o=n(15671),u=n(43144),c=n(82963),l=n(78814),h=n(61120),f=n(97326),d=n(60136),v=n(40101),p=n(72346),m=n(4942),y=n(43889),g=n(13092),Z=n(86033),w=n(68295),T=n(56777),k=n(90957),b=n(19435),R=n(97455),S=new WeakMap,F=new WeakMap,N=new WeakMap,O=new WeakMap,H=new WeakSet,A=new WeakSet,x=function(){function e(){var t=this;(0,o.Z)(this,e),(0,v.Z)(this,A),(0,v.Z)(this,H),(0,p.Z)(this,S,{writable:!0,value:void 0}),(0,p.Z)(this,F,{writable:!0,value:[]}),(0,p.Z)(this,N,{writable:!0,value:setTimeout((function(){return(0,y.Z)(t,A,M).call(t)}),5e3)}),(0,p.Z)(this,O,{writable:!0,value:!1})}return(0,u.Z)(e,[{key:"settle",value:function(e){!1===(0,Z.Z)(this,S)||(void 0===(0,Z.Z)(this,S)?(0,Z.Z)(this,F).push(e):e())}},{key:"decide",value:function(e){(0,Z.Z)(this,O)||((0,g.Z)(this,S,e),!1===e&&(0,y.Z)(this,A,M).call(this),!0===e&&(0,y.Z)(this,H,E).call(this))}},{key:"permanentlyDecide",value:function(e){(0,Z.Z)(this,O)||(this.decide(e),(0,g.Z)(this,O,!0))}}]),e}();function E(){(0,Z.Z)(this,F).forEach((function(e){return e()})),(0,y.Z)(this,A,M).call(this)}function M(){(0,g.Z)(this,F,[]),clearTimeout((0,Z.Z)(this,N))}var I=n(90489),L=n(23641),K=n(73198);function P(e){return U.apply(this,arguments)}function U(){return(U=(0,i.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=(0,I.fP)(),!(0,b.Mt)(t,"session_replay.enabled")||"object"!==typeof n.initializedAgents[t].features.session_replay){e.next=10;break}return e.next=5,n.initializedAgents[t].features.session_replay.onAggregateImported;case 5:if(!e.sent){e.next=10;break}return e.next=9,L.m.sessionReplayInitialized;case 9:return e.abrupt("return",e.sent);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(0);case 14:return e.abrupt("return",K.IK.OFF);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}var C=n(14415),X=n(51185);var _={global:{mouseup:!0,mousedown:!0},window:{load:!0,pagehide:!0},xhrOriginMissing:{ignoreAll:!0}},j={typing:[1e3,2e3],scrolling:[100,1e3],mousing:[1e3,2e3],touching:[1e3,2e3]},W=6e5,z=new WeakMap,D=new WeakSet,B=new WeakSet,q=new WeakMap,G=function(e){function t(e,n,r){var u,d,m,y,T;if((0,o.Z)(this,t),m=this,y=t,T=[e,n,R.t9],y=(0,h.Z)(y),u=(0,c.Z)(m,(0,l.Z)()?Reflect.construct(y,T||[],(0,h.Z)(m).constructor):y.apply(m,T)),(0,v.Z)((0,f.Z)(u),B),(0,v.Z)((0,f.Z)(u),D),(0,p.Z)((0,f.Z)(u),z,{writable:!0,value:void 0}),(0,p.Z)((0,f.Z)(u),q,{writable:!0,value:0}),d=(0,f.Z)(u),u.agentRuntime=(0,b.OP)(e),!u.agentRuntime.xhrWrappable)return(0,c.Z)(u);u.resourceObserver=null===r||void 0===r?void 0:r.resourceObserver,u.ptid="",u.trace={},u.nodeCount=0,u.sentTrace=null,u.harvestTimeSeconds=(0,b.Mt)(e,"session_trace.harvestTimeSeconds")||10,u.maxNodesPerHarvest=(0,b.Mt)(e,"session_trace.maxNodesPerHarvest")||1e3,u.isStandalone=!1;var k=new x,S=u.agentRuntime.session;u.operationalGate=k;var F,N=function(e){switch(e){case K.IK.ERROR:u.startTracing(k,!0);break;case K.IK.FULL:case!0:u.startTracing(k);break;case K.IK.OFF:default:k.decide(!1)}},O=!1;u.ee.on(K.wO.UPDATE,(function(e,t){t.sessionReplayMode===K.IK.FULL&&H()}));var H=function(){var e;if((null===(e=u.agentRuntime)||void 0===e||null===(e=e.session)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.sessionReplayMode)===K.IK.FULL&&F!==K.IK.FULL){var t=F;F=K.IK.FULL,S.write({sessionTraceMode:F}),u.isStandalone=!1,t===K.IK.ERROR&&(0,Z.Z)((0,f.Z)(u),z)?(u.trimSTNs(3e4),(0,Z.Z)((0,f.Z)(u),z).runHarvest({needResponse:!0})):N(K.IK.FULL)}};if(S){(0,w.X)("errorAgg",(function(){O=!0,H()}),u.featureName,u.ee);var A=function(){var e,t;S.state.sessionTraceMode!==K.IK.OFF&&S.write({sessionTraceMode:K.IK.OFF}),k.permanentlyDecide(!1),F===K.IK.FULL&&(null===(e=(0,Z.Z)((0,f.Z)(u),z))||void 0===e||e.runHarvest()),null===(t=(0,Z.Z)((0,f.Z)(u),z))||void 0===t||t.stopTimer(!0),(0,g.Z)((0,f.Z)(u),z,null)};u.waitForFlags(["stn","sr"]).then(function(){var t=(0,i.Z)((0,s.Z)().mark((function t(n){var r,i,o,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(0,a.Z)(n,2),i=r[0],r[1]){t.next=6;break}u.isStandalone=!0,N(i),t.next=21;break;case 6:if(u.ee.on("REPLAY_ABORTED",(function(){return A()})),u.ee.on(K.wO.RESUME,(function(){var e=S.state.sessionTraceMode;e===K.IK.OFF?A():e===K.IK.FULL&&(0,Z.Z)((0,f.Z)(u),z)&&!(0,Z.Z)((0,f.Z)(u),z).started&&(0,Z.Z)((0,f.Z)(u),z).runHarvest({needResponse:!0}),F=e})),u.ee.on(K.wO.PAUSE,(function(){F=S.state.sessionTraceMode})),S.isNew){t.next=14;break}S.state.sessionReplayMode===K.IK.OFF&&(u.isStandalone=!0),N(F=S.state.sessionTraceMode),t.next=21;break;case 14:return t.next=16,P(e);case 16:(o=t.sent)===K.IK.OFF&&(u.isStandalone=!0),c=i||o===K.IK.ERROR&&O?K.IK.FULL:o,S.write({sessionTraceMode:F=c}),N(c);case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}else u.isStandalone=!0,u.waitForFlags(["stn"]).then((function(e){var t=(0,a.Z)(e,1)[0];return N(t)}),u.featureName,u.ee);return(0,w.X)("bst",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.settle((function(){var e;return(e=d).storeEvent.apply(e,t)}))}),u.featureName,u.ee),(0,w.X)("bstResource",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.settle((function(){var e;return(e=d).storeResources.apply(e,t)}))}),u.featureName,u.ee),(0,w.X)("bstHist",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.settle((function(){var e;return(e=d).storeHist.apply(e,t)}))}),u.featureName,u.ee),(0,w.X)("bstXhrAgg",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.settle((function(){var e;return(e=d).storeXhrAgg.apply(e,t)}))}),u.featureName,u.ee),(0,w.X)("bstApi",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.settle((function(){var e;return(e=d).storeSTN.apply(e,t)}))}),u.featureName,u.ee),(0,w.X)("errorAgg",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.settle((function(){var e;return(e=d).storeErrorAgg.apply(e,t)}))}),u.featureName,u.ee),(0,w.X)("pvtAdded",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k.settle((function(){var e;return(e=d).processPVT.apply(e,t)}))}),u.featureName,u.ee),u.drain(),u}return(0,d.Z)(t,e),(0,u.Z)(t,[{key:"startTracing",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"undefined"!==typeof PerformanceNavigationTiming?this.storeTiming(window.performance.getEntriesByType("navigation")[0]):this.storeTiming(window.performance.timing),(0,g.Z)(this,z,new T.o("resources",{onFinished:(0,y.Z)(this,D,V).bind(this),retryDelay:this.harvestTimeSeconds},this)),(0,Z.Z)(this,z).harvest.on("resources",(0,y.Z)(this,B,Y).bind(this)),!1===t&&(0,Z.Z)(this,z).runHarvest({needResponse:!0}),e.decide(!0)}},{key:"processPVT",value:function(e,t,n){this.storeTiming((0,m.Z)({},e,t)),function(e,t){return"fi"===e&&!!t&&"number"===typeof t.fid}(e,n)&&this.storeEvent({type:"fid",target:"document"},"document",t,t+n.fid)}},{key:"storeTiming",value:function(e){if(e)for(var t in e){var n=e[t],r=t.toLowerCase();r.indexOf("size")>=0||r.indexOf("status")>=0||"number"===typeof n&&n>=0&&(n=Math.round(n),this.storeSTN({n:t,s:n,e:n,o:"document",t:"timing"}))}}},{key:"storeEvent",value:function(e,t,n,r){if(!this.shouldIgnoreEvent(e,t)){var s={n:this.evtName(e.type),s:n,e:r,t:"event"};try{s.o=this.evtOrigin(e.target,t)}catch(i){s.o=this.evtOrigin(null,t)}this.storeSTN(s)}}},{key:"shouldIgnoreEvent",value:function(e,t){var n=this.evtOrigin(e.target,t);return e.type in _.global||(!(!_[n]||!_[n].ignoreAll)||!(!_[n]||!(e.type in _[n])))}},{key:"evtName",value:function(e){switch(e){case"keydown":case"keyup":case"keypress":return"typing";case"mousemove":case"mouseenter":case"mouseleave":case"mouseover":case"mouseout":return"mousing";case"scroll":return"scrolling";case"touchstart":case"touchmove":case"touchend":case"touchcancel":case"touchenter":case"touchleave":return"touching";default:return e}}},{key:"evtOrigin",value:function(e,t){var n="unknown";if(e&&e instanceof XMLHttpRequest){var r=this.ee.context(e).params;if(!r||!r.status||!r.method||!r.host||!r.pathname)return"xhrOriginMissing";n=r.status+" "+r.method+": "+r.host+r.pathname}else if(e&&"string"===typeof e.tagName&&(n=e.tagName.toLowerCase(),e.id&&(n+="#"+e.id),e.className))for(var s=0;s<e.classList.length;s++)n+="."+e.classList[s];return"unknown"===n&&("string"===typeof t?n=t:t===document?n="document":t===window?n="window":t instanceof FileReader&&(n="FileReader")),n}},{key:"storeHist",value:function(e,t,n){var r={n:"history.pushState",s:n,e:n,o:e,t:t};this.storeSTN(r)}},{key:"storeResources",value:function(e){var t=this;e&&0!==e.length&&(e.forEach((function(e){if(!((0|e.fetchStart)<=(0,Z.Z)(t,q))){var n=(0,k.e)(e.name),r={n:e.initiatorType,s:0|e.fetchStart,e:0|e.responseEnd,o:n.protocol+"://"+n.hostname+":"+n.port+n.pathname,t:e.entryType};t.storeSTN(r)}})),(0,g.Z)(this,q,0|e[e.length-1].fetchStart))}},{key:"storeErrorAgg",value:function(e,t,n,r){if("err"===e){var s={n:"error",s:r.time,e:r.time,o:n.message,t:n.stackHash};this.storeSTN(s)}}},{key:"storeXhrAgg",value:function(e,t,n,r){if("xhr"===e){var s={n:"Ajax",s:r.time,e:r.time+r.duration,o:n.status+" "+n.method+": "+n.host+n.pathname,t:"ajax"};this.storeSTN(s)}}},{key:"storeSTN",value:function(e){if(this.nodeCount>=this.maxNodesPerHarvest){if(this.isStandalone||this.agentRuntime.session.state.sessionTraceMode!==K.IK.ERROR)return;if(0===this.trimSTNs(3e4))return}this.isStandalone&&(0,X.z)()>=W||(this.trace[e.n]?this.trace[e.n].push(e):this.trace[e.n]=[e],this.nodeCount++)}},{key:"trimSTNs",value:function(e){var t=this,n=0,r=Math.max((0,X.z)()-e,0);return Object.keys(this.trace).forEach((function(e){var s=t.trace[e],i=s.findIndex((function(e){return r<=e.e}));0!==i&&(i<0?(i=s.length,delete t.trace[e]):s.splice(0,i),t.nodeCount-=i,n+=i)})),n}},{key:"takeSTNs",value:function(e){var t=this;this.resourceObserver||this.storeResources(window.performance.getEntriesByType("resource"));var n,s=1/0,i=Object.entries(this.trace).flatMap((function(e){var n=(0,a.Z)(e,2),r=n[0],i=n[1],o=i.reduce((function(e,t){return!e||t.s<e?t.s:e}),void 0);if(o<s&&(s=o),!(r in j))return i;var u=t.smearEvtsByOrigin(r),c=i.sort((function(e,t){return e.s-t.s})).reduce(u,{});return Object.values(c).flat()}),this);if(0===i.length)return{};if(e&&(this.sentTrace=this.trace),this.trace={},this.nodeCount=0,this.agentRuntime.session){var o=!this.agentRuntime.session.state.traceHarvestStarted;n={fsh:Number(o)},o&&this.agentRuntime.session.write({traceHarvestStarted:!0})}return{qs:(0,r.Z)({st:this.agentRuntime.offset,hr:Number(!this.isStandalone),fts:this.agentRuntime.offset+s,n:i.length},n),body:{res:i}}}},{key:"smearEvtsByOrigin",value:function(e){var t=j[e][0],n=j[e][1],r={};return function(s,i){var a=s[i.o];a||(a=s[i.o]=[]);var o=r[i.o];return"scrolling"!==e||function(e){var t=4;return!!(e&&"number"===typeof e.e&&"number"===typeof e.s&&e.e-e.s<t)}(i)?o&&i.s-o.s<n&&o.e>i.s-t?o.e=i.e:(r[i.o]=i,a.push(i)):(r[i.o]=null,i.n="scroll",a.push(i)),s}}}]),t}(C.m);function V(e){var t=this;e.sent&&e.responseText&&!this.ptid&&(this.agentRuntime.ptid=this.ptid=e.responseText,(0,Z.Z)(this,z).startTimer(this.harvestTimeSeconds)),e.sent&&e.retry&&this.sentTrace&&(Object.entries(this.sentTrace).forEach((function(e){var n=(0,a.Z)(e,2),r=n[0],s=n[1];t.nodeCount>=t.maxNodesPerHarvest||(t.nodeCount+=s.length,t.trace[r]=t.trace[r]?s.concat(t.trace[r]):s)})),this.sentTrace=null)}function Y(e){if(this.isStandalone){if(this.ptid&&(0,X.z)()>=W)e.isFinalHarvest=!0,this.operationalGate.permanentlyDecide(!1),(0,Z.Z)(this,z).stopTimer(!0);else if(this.ptid&&this.nodeCount<=30&&!e.isFinalHarvest)return}else{var t=this.agentRuntime.session.state.sessionTraceMode;if(t===K.IK.OFF&&0===Object.keys(this.trace).length)return;if(t===K.IK.ERROR)return}return this.takeSTNs(e.retry)}(0,m.Z)(G,"featureName",R.t9)}}]);
//# sourceMappingURL=session_trace-aggregate.d6f75e2e.chunk.js.map