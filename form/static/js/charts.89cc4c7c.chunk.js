"use strict";(self.webpackChunkappsmith=self.webpackChunkappsmith||[]).push([[4482],{3570:function(t,e,n){var s=n(50390);e.Z=function(t){var e=(0,s.useRef)();return(0,s.useEffect)((function(){e.current=t})),e.current}},67208:function(t,e,n){n.r(e),n.d(e,{default:function(){return Y},mapStateToProps:function(){return V}});var s,i,r=n(45987),a=n(1413),o=n(15671),c=n(43144),h=n(82963),d=n(78814),u=n(61120),p=n(60136),l=n(30168),C=n(50390),v=n(62608),f=n(13700),g=n(56679),m=n(93782),y=n(5886),T=n.n(y),k=n(8960),w=n.n(k),I=n(41529),E=n(33667),S=n(70854),Z=n(37762),b=n(29439),O=n(3570),M=n(62559),F=v.ZP.iframe(s||(s=(0,l.Z)(["\n  position: relative;\n  height: 100%;\n  width: 100%;\n"]))),U=v.ZP.div(i||(i=(0,l.Z)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n"])));function D(t){var e=(0,C.useState)(void 0),n=(0,b.Z)(e,2),s=n[0],i=n[1],r=(0,C.useState)(void 0),a=(0,b.Z)(r,2),o=a[0],c=a[1],h=(0,O.Z)(t),d=(0,C.useRef)(null),u=function(t){var e,n=null===(e=d.current)||void 0===e?void 0:e.contentWindow;null===n||void 0===n||n.postMessage(t,"*")},p=function(e){var n,s=null===(n=d.current)||void 0===n?void 0:n.contentWindow;if(s&&e.source==s){var r=e.data;switch(r.type){case"click-event":var a=r.data;(0,S.ai)(a.event,t,"CUSTOM_ECHART");break;case"load-complete":u({options:(0,S.q_)("CUSTOM_ECHART",t),shouldUpdateOptions:!0,shouldResize:!1,width:t.dimensions.componentWidth,height:t.dimensions.componentHeight});break;case"error":var o=r.data;i(o.message),c(o.stack);break;default:return}}};function l(t,e,n){var s=null===t||void 0===t?void 0:t.getHeight(),i=null===t||void 0===t?void 0:t.getWidth();return s!=n||i!=e}function v(t,e){for(var n,s=e.cloneDeep(t),i=null!==(n=s.__fn_keys__)&&void 0!==n?n:[],r=0;r<i.length;r++){var a=e.get(s,i[r]),o=new Function("return "+a)();e.set(s,i[r],o)}return s}function f(t){var e,n="",s=(0,Z.Z)(t);try{for(s.s();!(e=s.n()).done;){n+=e.value.toString(),n+="\n"}}catch(i){s.e(i)}finally{s.f()}return n}function g(t){var e=document.getElementById("chartdiv");return t.init(e,void 0)}var m='\n        <head>\n            <style type="text/css">\n                body {\n                    margin:0 0 0 0px;\n                }\n            </style>\n            \n            <script src="/libraries/echarts@5.4.3.js"><\/script>\n            <script src="/libraries/echarts-gl@2.0.9.js"><\/script>\n            <script src="/libraries/lodash@4.17.21.js"><\/script>\n        </head>\n\n        <body>\n            <div id="chartdiv" style="position:absolute; height: 100%; width: 100%;"></div>\n    \n            <script>\n                '.concat(f([v,g,l]),"\n\n                let echartsInstance = undefined;\n\n                window.onload = ").concat(f([function(){parent.postMessage({type:"load-complete",data:{}},"*")}]),"\n\n                window.onmessage = function(e) {\n                    ((").concat(f([function(t,e,n,s){var i=t.data;if(i&&i.hasOwnProperty("options")){var r=v(i.options,n);try{e&&!e.isDisposed()||(e=g(s)),i.shouldUpdateOptions&&e.setOption(r,!0),i.shouldResize&&l(e,i.width,i.height)&&e.resize({width:i.width,height:i.height})}catch(o){e.dispose();var a={type:"error",data:{message:o.message,stack:o.stack||""}};parent.postMessage(a,"*")}e.off("click"),e.on("click",(function(t){var e={type:"click-event",data:{event:n.omit(n.cloneDeep(t),"event")}};parent.postMessage(e,"*")}))}}]),")(e, echartsInstance, _, echarts))\n                }\n            <\/script>\n        </body>\n        ");return(0,C.useEffect)((function(){return window.addEventListener("message",p),function(){window.removeEventListener("message",p)}})),(0,C.useEffect)((function(){var e=!0,n=w()(null===h||void 0===h?void 0:h.customEChartConfig,t.customEChartConfig);s?n?e=!1:(i(void 0),c(void 0)):n&&(e=!1),u({options:(0,S.q_)("CUSTOM_ECHART",t),shouldUpdateOptions:e,shouldResize:!0,width:t.dimensions.componentWidth,height:t.dimensions.componentHeight})})),(0,M.jsxs)(M.Fragment,{children:[s&&(0,M.jsx)(I.r,{message:s,stack:o}),!s&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(F,{ref:d,sandbox:"allow-scripts",scrolling:"no",srcDoc:m,style:{height:"100%",width:"100%"}}),t.needsOverlay&&(0,M.jsx)(U,{"data-testid":"iframe-overlay"})]})]})}var _,H,R=n(95765),x=n(61575),P=n(81591),j=n(92292),L=n(79920),A=["hasOnDataPointClick","onDataPointClick"];var W=n(96289),z={Charts:n(28032),FusionTheme:n(99855),Widgets:n(31940),ZoomScatter:n(32437),ZoomLine:n(59254),PowerCharts:n(4668),TimeSeries:n(30721),OverlappedColumn:n(71854),OverlappedBar:n(80172),TreeMap:n(58200),Maps:n(81235),Gantt:n(99911),VML:n(76117)};Object.keys(z).forEach((function(t){return z[t](W)}));var B=(0,m.x)().fusioncharts;W.options.license({key:B.licenseKey,creditLabel:!1});var N=v.ZP.div(_||(_=(0,l.Z)(["\n  position: relative;\n  height: 100%;\n  width: 100%;\n"]))),q=v.ZP.div(H||(H=(0,l.Z)(["\n  border-radius: ",";\n  box-shadow: "," !important;\n\n  height: 100%;\n  width: 100%;\n  background: var(--ads-v2-color-bg);\n  overflow: hidden;\n  position: relative;\n  ",";\n}"])),(function(t){return t.borderRadius}),(function(t){var e=t.boxShadow;return"".concat(e)}),(function(t){return t.isVisible?"":g.KM})),K=function(t){function e(t){var n,s,i,r;return(0,o.Z)(this,e),s=this,i=e,r=[t],i=(0,u.Z)(i),(n=(0,h.Z)(s,(0,d.Z)()?Reflect.construct(i,r||[],(0,u.Z)(s).constructor):i.apply(s,r))).fusionChartsInstance=null,n.echartsInstance=void 0,n.customFusionChartContainerId=n.props.widgetId+"custom-fusion-chart-container",n.eChartsContainerId=n.props.widgetId+"echart-container",n.eChartsHTMLContainer=null,n.echartsConfigurationBuilder=void 0,n.echartConfiguration={},n.prevProps=void 0,n.dataClickCallback=function(t){(0,S.ai)(t,n.props,n.state.chartType)},n.initializeEchartsInstance=function(){n.eChartsHTMLContainer=document.getElementById(n.eChartsContainerId),n.eChartsHTMLContainer&&(n.echartsInstance&&!n.echartsInstance.isDisposed()||(n.echartsInstance=f.S1(n.eChartsHTMLContainer,void 0,{renderer:"svg",width:n.props.dimensions.componentWidth,height:n.props.dimensions.componentHeight})))},n.shouldResizeECharts=function(){var t,e;return(null===(t=n.echartsInstance)||void 0===t?void 0:t.getHeight())!=n.props.dimensions.componentHeight||(null===(e=n.echartsInstance)||void 0===e?void 0:e.getWidth())!=n.props.dimensions.componentWidth},n.renderECharts=function(){if(n.initializeEchartsInstance(),n.echartsInstance){var t=(0,S.q_)(n.state.chartType,n.props);try{n.shouldSetOptions(t)&&(n.echartConfiguration=t,n.echartsInstance.setOption(n.echartConfiguration,!0),n.state.eChartsError&&n.setState({eChartsError:void 0})),n.shouldResizeECharts()&&n.echartsInstance.resize({width:n.props.dimensions.componentWidth,height:n.props.dimensions.componentHeight}),n.echartsInstance.off("click"),n.echartsInstance.on("click",n.dataClickCallback)}catch(e){n.disposeECharts(),n.setState({eChartsError:e})}}},n.disposeECharts=function(){var t,e;null!==(t=n.echartsInstance)&&void 0!==t&&t.isDisposed()||(null===(e=n.echartsInstance)||void 0===e||e.dispose())},n.disposeFusionCharts=function(){n.fusionChartsInstance=null},n.renderFusionCharts=function(){if(n.fusionChartsInstance){var t=n.getCustomFusionChartDataSource(),e=t.dataSource,s=t.type;n.fusionChartsInstance.chartType(s),n.fusionChartsInstance.setChartData(e)}else{var i=n.customFusionChartConfig();n.fusionChartsInstance=new W(i),W.ready((function(){if(n.fusionChartsInstance)try{n.fusionChartsInstance.render()}catch(r){T().error(r)}}))}},n.getCustomFusionChartDataSource=function(){var t=n.props.customFusionChartConfig;return t&&t.dataSource&&(t=(0,a.Z)((0,a.Z)({},t),{},{dataSource:(0,a.Z)({chart:(0,a.Z)((0,a.Z)({},t.dataSource.chart),{},{caption:n.props.chartName||t.dataSource.chart.caption,setAdaptiveYMin:n.props.setAdaptiveYMin?"1":"0"})},t.dataSource)})),t||{}},n.echartsConfigurationBuilder=new E.X,n.prevProps={},n.state={eChartsError:void 0,chartType:n.props.chartType},n}return(0,p.Z)(e,t),(0,c.Z)(e,[{key:"shouldSetOptions",value:function(t){return!w()(this.echartConfiguration,t)}},{key:"componentDidMount",value:function(){this.renderChartingLibrary()}},{key:"componentWillUnmount",value:function(){this.disposeECharts(),this.disposeFusionCharts()}},{key:"renderChartingLibrary",value:function(){"CUSTOM_FUSION_CHART"===this.state.chartType?(this.disposeECharts(),this.renderFusionCharts()):"CUSTOM_ECHART"==this.state.chartType?(this.disposeECharts(),this.disposeFusionCharts()):(this.disposeFusionCharts(),this.renderECharts())}},{key:"componentDidUpdate",value:function(){(0,S.li)(this.props.chartType)&&!(0,S.li)(this.state.chartType)?this.setState({eChartsError:void 0,chartType:"CUSTOM_FUSION_CHART"}):(0,S.UU)(this.props.chartType)&&!(0,S.UU)(this.state.chartType)?(this.echartConfiguration={},this.setState({eChartsError:void 0,chartType:"CUSTOM_ECHART"})):(0,S.De)(this.props.chartType)&&!(0,S.De)(this.state.chartType)?(this.echartConfiguration={},this.setState({eChartsError:void 0,chartType:this.props.chartType})):this.renderChartingLibrary()}},{key:"customFusionChartConfig",value:function(){var t=this;return(0,a.Z)({renderAt:this.customFusionChartContainerId,width:"100%",height:"100%",events:{dataPlotClick:function(e){var n=(0,S.Lv)(e,t.state.chartType);t.props.onDataPointClick(n)}}},this.getCustomFusionChartDataSource())}},{key:"render",value:function(){var t=this.props,e=t.hasOnDataPointClick,n=(t.onDataPointClick,(0,r.Z)(t,A)),s=e?function(t){return t.stopPropagation()}:void 0;return(0,M.jsxs)(q,(0,a.Z)((0,a.Z)({className:this.props.isLoading?"bp3-skeleton":"",onClick:s},n),{},{children:[(0,S.De)(this.state.chartType)&&(0,M.jsx)(N,{id:this.eChartsContainerId}),(0,S.UU)(this.state.chartType)&&(0,M.jsx)(D,(0,a.Z)({},this.props)),"CUSTOM_FUSION_CHART"===this.state.chartType&&(0,M.jsx)(N,{id:this.customFusionChartContainerId}),this.state.eChartsError&&(0,M.jsx)(I.r,{error:this.state.eChartsError})]}))}}]),e}(C.Component),V=function(t,e){var n,s=(0,P.ew)(t);return{needsOverlay:(0,j.kZ)(t)==L.p.EDIT&&!s&&e.widgetId!==(null===(n=(0,x.nO)(t))||void 0===n?void 0:n.widgetId)}},Y=(0,R.$j)(V)(K)}}]);
//# sourceMappingURL=charts.89cc4c7c.chunk.js.map