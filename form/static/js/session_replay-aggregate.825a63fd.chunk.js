"use strict";(self.webpackChunkappsmith=self.webpackChunkappsmith||[]).push([[9590],{23641:function(e,t,i){var r;i.d(t,{m:function(){return n}});var s=new Promise((function(e){r=e})),n=Object.freeze({onReplayReady:r,sessionReplayInitialized:s})},56777:function(e,t,i){i.d(t,{o:function(){return y}});var r=i(93433),s=i(15671),n=i(43144),o=i(82963),a=i(78814),l=i(61120),d=i(97326),u=i(60136),c=i(75284),h=i(9831),p=i(19198),v=i(99712),f=i(73198);var y=function(e){function t(e,i,r){var n,u,c,h,y;return(0,s.Z)(this,t),c=this,h=t,y=[r],h=(0,l.Z)(h),(u=(0,o.Z)(c,(0,a.Z)()?Reflect.construct(h,y||[],(0,l.Z)(c).constructor):h.apply(c,y))).endpoint=e,u.opts=i||{},u.started=!1,u.timeoutHandle=null,u.aborted=!1,u.harvest=new p.M(u.sharedContext),(0,v.L)(u.unload.bind((0,d.Z)(u))),null===(n=u.sharedContext)||void 0===n||n.ee.on(f.wO.RESET,(function(){return u.runHarvest({forceNoRetry:!0})})),u}return(0,u.Z)(t,e),(0,n.Z)(t,[{key:"unload",value:function(){this.aborted||(this.opts.onUnload&&this.opts.onUnload(),this.runHarvest({unload:!0}))}},{key:"startTimer",value:function(e,t){this.interval=e,this.started=!0,this.scheduleHarvest(null!=t?t:this.interval)}},{key:"stopTimer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.aborted=e,this.started=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}},{key:"scheduleHarvest",value:function(e,t){var i=this;this.timeoutHandle||(null==e&&(e=this.interval),this.timeoutHandle=setTimeout((function(){i.timeoutHandle=null,i.runHarvest(t)}),1e3*e))}},{key:"runHarvest",value:function(e){var t=this;if(!this.aborted){var i,s,n=function(i){null!==e&&void 0!==e&&e.forceNoRetry&&(i.retry=!1),t.onHarvestFinished(e,i)},o=[];if(this.opts.getPayload){if(!(i=c.qD({isFinalHarvest:null===e||void 0===e?void 0:e.unload})))return!1;var a=!(null!==e&&void 0!==e&&e.unload)&&i===c.Be;if(!(s=this.opts.getPayload({retry:a,opts:e})))return void(this.started&&this.scheduleHarvest());s="[object Array]"===Object.prototype.toString.call(s)?s:[s],o.push.apply(o,(0,r.Z)(s))}var l=function(e){return t.harvest.sendX(e)};o.length?l=this.opts.raw?function(e){return t.harvest._send(e)}:function(e){return t.harvest.send(e)}:o.push(void 0),o.forEach((function(r){l({endpoint:t.endpoint,payload:r,opts:e,submitMethod:i,cbFinished:n,customUrl:t.opts.customUrl,raw:t.opts.raw})})),this.started&&this.scheduleHarvest()}}},{key:"onHarvestFinished",value:function(e,t){if(this.opts.onFinished&&this.opts.onFinished(t),t.sent&&t.retry){var i=t.delay||this.opts.retryDelay;this.started&&i?(clearTimeout(this.timeoutHandle),this.timeoutHandle=null,this.scheduleHarvest(i,e)):!this.started&&i&&this.scheduleHarvest(i,e)}}}]),t}(h.w)},99712:function(e,t,i){i.d(t,{L:function(){return l}});var r=i(37762),s=i(98841),n=i(63711),o=i(73087);if(n.v6){n._A.cleanupTasks=[];var a=n._A.close;n._A.close=function(){var e,t=(0,r.Z)(n._A.cleanupTasks);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(i){t.e(i)}finally{t.f()}a()}}function l(e){n.il?((0,o.N)(e,!0),(0,s.bP)("pagehide",e)):n.v6&&n._A.cleanupTasks.push(e)}},14456:function(e,t,i){i.r(t),i.d(t,{Aggregate:function(){return A}});var r=i(1413),s=i(45987),n=i(74165),o=i(15861),a=i(29439),l=i(15671),d=i(43144),u=i(82963),c=i(78814),h=i(61120),p=i(97326),v=i(60136),f=i(4942),y=i(68295),m=i(56777),g=i(90830),S=i(19435),b=i(14415),R=i(23641),k=i(41130),M=i(31390),Z=i(63711),T=i(12088),x=i(38450),F=i(30733),w=i(26158),_=i(73198),E=i(17610),O=i(98097),I=i(21782),H=i(51185),C=["__serialized"];var A=function(e){function t(e,i,r){var s,n,o,d;(0,l.Z)(this,t),n=this,o=t,d=[e,i,g.t9],o=(0,h.Z)(o),(s=(0,u.Z)(n,(0,c.Z)()?Reflect.construct(o,d||[],(0,h.Z)(n).constructor):o.apply(n,d))).harvestTimeSeconds=(0,S.Mt)(s.agentIdentifier,"session_replay.harvestTimeSeconds")||60,s.initialized=!1,s.blocked=!1,s.gzipper=void 0,s.u8=void 0;var v=(0,S.OP)(s.agentIdentifier).session;s.mode=v.state.sessionReplayMode||_.IK.OFF,s.entitled=!1,s.timeKeeper=void 0,s.recorder=null===r||void 0===r?void 0:r.recorder,s.recorder&&(s.recorder.parent=(0,p.Z)(s)),(0,x.p)(T.xS,["Config/SessionReplay/Enabled"],void 0,F.D.metrics,s.ee),s.ee.on(_.wO.RESET,(function(){s.scheduler.runHarvest(),s.abort(g.Mi.RESET)})),s.ee.on(_.wO.PAUSE,(function(){var e;null===(e=s.recorder)||void 0===e||e.stopRecording()})),s.ee.on(_.wO.RESUME,(function(){var e;if(s.recorder){var t=(0,S.OP)(s.agentIdentifier).session;s.mode=t.state.sessionReplayMode,s.initialized&&s.mode!==_.IK.OFF&&(null===(e=s.recorder)||void 0===e||e.startRecording())}})),s.ee.on(_.wO.UPDATE,(function(e,t){s.recorder&&s.initialized&&!s.blocked&&e===_.uT.CROSS_TAB&&(s.mode!==_.IK.OFF&&t.sessionReplayMode===_.IK.OFF&&s.abort(g.Mi.CROSS_TAB),s.mode=t.sessionReplay)})),s.scheduler=new m.o("browser/blobs",{onFinished:s.onHarvestFinished.bind((0,p.Z)(s)),retryDelay:s.harvestTimeSeconds,getPayload:s.prepareHarvest.bind((0,p.Z)(s)),raw:!0},(0,p.Z)(s)),(0,y.X)(g.Ef.RECORD,(function(){!s.blocked&&s.entitled&&(s.recorder?s.mode!==_.IK.FULL&&s.switchToFull():s.initializeRecording(!1,!0,!0))}),s.featureName,s.ee),(0,y.X)(g.Ef.PAUSE,(function(){s.forceStop(s.mode!==_.IK.ERROR)}),s.featureName,s.ee),(0,y.X)("errorAgg",(function(e){s.errorNoticed=!0,s.recorder&&(s.recorder.currentBufferTarget.hasError=!0),s.mode===_.IK.ERROR&&"visible"===(null===Z._A||void 0===Z._A?void 0:Z._A.document.visibilityState)&&s.switchToFull()}),s.featureName,s.ee);var f=(0,S.Mt)(s.agentIdentifier,"session_replay"),b=f.error_sampling_rate,k=f.sampling_rate,M=f.autoStart,w=f.block_selector,E=f.mask_text_selector,O=f.mask_all_inputs,H=f.inline_stylesheet,C=f.inline_images,A=f.collect_fonts;return s.waitForFlags(["sr"]).then((function(e){var t,i=(0,a.Z)(e,1)[0];if(s.entitled=i,!s.entitled)return(0,I.o5)(s.agentIdentifier,s.featureName),void(null!==(t=s.recorder)&&void 0!==t&&t.recording&&(s.abort(g.Mi.ENTITLEMENTS),(0,x.p)(T.xS,["SessionReplay/EnabledNotEntitled/Detected"],void 0,F.D.metrics,s.ee)));s.drain(),s.initializeRecording(100*Math.random()<b,100*Math.random()<k)})).then((function(){var e;s.mode===_.IK.OFF&&(null===r||void 0===r||null===(e=r.recorder)||void 0===e||e.stopRecording()),R.m.onReplayReady(s.mode)})),M||(0,x.p)(T.xS,["Config/SessionReplay/AutoStart/Modified"],void 0,F.D.metrics,s.ee),!0===A&&(0,x.p)(T.xS,["Config/SessionReplay/CollectFonts/Modified"],void 0,F.D.metrics,s.ee),!0!==H&&(0,x.p)(T.xS,["Config/SessionReplay/InlineStylesheet/Modified"],void 0,F.D.metrics,s.ee),!0===C&&(0,x.p)(T.xS,["Config/SessionReplay/InlineImages/Modifed"],void 0,F.D.metrics,s.ee),!0!==O&&(0,x.p)(T.xS,["Config/SessionReplay/MaskAllInputs/Modified"],void 0,F.D.metrics,s.ee),"[data-nr-block]"!==w&&(0,x.p)(T.xS,["Config/SessionReplay/BlockSelector/Modified"],void 0,F.D.metrics,s.ee),"*"!==E&&(0,x.p)(T.xS,["Config/SessionReplay/MaskTextSelector/Modified"],void 0,F.D.metrics,s.ee),(0,x.p)(T.xS,["Config/SessionReplay/SamplingRate/Value",k],void 0,F.D.metrics,s.ee),(0,x.p)(T.xS,["Config/SessionReplay/ErrorSamplingRate/Value",b],void 0,F.D.metrics,s.ee),s}return(0,v.Z)(t,e),(0,d.Z)(t,[{key:"switchToFull",value:function(){this.mode=_.IK.FULL,this.recorder&&this.initialized&&(this.recorder.stopRecording(),this.recorder.startRecording(),this.scheduler.startTimer(this.harvestTimeSeconds),this.syncWithSessionManager({sessionReplayMode:this.mode}))}},{key:"initializeRecording",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,s){var o,a,l,d,u,c,h=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized=!0,this.entitled){e.next=3;break}return e.abrupt("return");case 3:if(a=(0,S.OP)(this.agentIdentifier),l=a.session,d=a.timeKeeper,this.timeKeeper=d,l.isNew||s){e.next=9;break}this.mode=l.state.sessionReplayMode,e.next=18;break;case 9:if(!r){e.next=13;break}this.mode=_.IK.FULL,e.next=18;break;case 13:if(!t){e.next=17;break}this.mode=_.IK.ERROR,e.next=18;break;case 17:return e.abrupt("return");case 18:if("preloaded"===(null===(o=this.recorder)||void 0===o?void 0:o.getEvents().type)&&this.prepUtils().then((function(){h.scheduler.runHarvest()})),this.recorder){e.next=32;break}return e.prev=20,e.next=23,i.e(7538).then(i.bind(i,48706));case 23:u=e.sent,c=u.Recorder,this.recorder=new c(this),this.recorder.currentBufferTarget.hasError=this.errorNoticed,e.next=32;break;case 29:return e.prev=29,e.t0=e.catch(20),e.abrupt("return",this.abort(g.Mi.IMPORT));case 32:return this.mode===_.IK.ERROR&&this.errorNoticed&&(this.mode=_.IK.FULL),this.mode!==_.IK.FULL||this.scheduler.started||this.scheduler.startTimer(this.harvestTimeSeconds),e.next=36,this.prepUtils();case 36:this.recorder.recording||this.recorder.startRecording(),this.syncWithSessionManager({sessionReplayMode:this.mode});case 38:case"end":return e.stop()}}),e,this,[[20,29]])})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"prepUtils",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(){var t,r,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.e(3675).then(i.bind(i,39750));case 3:t=e.sent,r=t.gzipSync,s=t.strToU8,this.gzipper=r,this.u8=s,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"prepareHarvest",value:function(){var e,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).opts;if(this.recorder&&null!==(e=this.timeKeeper)&&void 0!==e&&e.ready){var i=this.recorder.getEvents();if(i.events.length&&this.mode===_.IK.FULL&&!this.blocked){var r=this.getHarvestContents(i);if(r.body.length){var n=0;if(this.gzipper&&this.u8?(r.body=this.gzipper(this.u8("[".concat(r.body.map((function(e){return e.__serialized?e.__serialized:(0,E.P)(e)})).join(","),"]"))),n=r.body.length,this.scheduler.opts.gzip=!0):(r.body=r.body.map((function(e){e.__serialized;return(0,s.Z)(e,C)})),n=(0,E.P)(r.body).length,this.scheduler.opts.gzip=!1),!(n>g.Ye))return(0,S.OP)(this.agentIdentifier).session.state.sessionReplaySentFirstChunk||this.syncWithSessionManager({sessionReplaySentFirstChunk:!0}),this.recorder.clearBuffer(),"preloaded"===i.type&&this.scheduler.runHarvest(t),[r];this.abort(g.Mi.TOO_BIG)}else this.recorder.clearBuffer()}}}},{key:"getHarvestContents",value:function(e){var t,i,s,n,o,a,l;null!==(t=e)&&void 0!==t||(e=this.recorder.getEvents());var d=e.events,u=(0,S.OP)(this.agentIdentifier),c=(0,S.C5)(this.agentIdentifier),h=null===(i=c.jsAttributes)||void 0===i?void 0:i["enduser.id"];(null===(s=d)||void 0===s||null===(s=s[0])||void 0===s?void 0:s.type)===g.i9.FullSnapshot&&this.recorder.lastMeta&&(e.hasMeta=!0,d.unshift(this.recorder.lastMeta),this.recorder.lastMeta=void 0),(null===(n=d[d.length-1])||void 0===n?void 0:n.type)===g.i9.Meta&&(this.recorder.lastMeta=d[d.length-1],d=d.slice(0,d.length-1),e.hasMeta=!!d.find((function(e){return e.type===g.i9.Meta})));var p=(0,H.z)(),v=null===(o=d[0])||void 0===o?void 0:o.timestamp,f=null===(a=d[d.length-1])||void 0===a?void 0:a.timestamp,y=v||this.timeKeeper.correctAbsoluteTimestamp(e.cycleTimestamp),m=f||this.timeKeeper.convertRelativeTimestamp(p),b=(null===(l=u.appMetadata)||void 0===l||null===(l=l.agents)||void 0===l?void 0:l[0])||{};return{qs:{browser_monitoring_key:c.licenseKey,type:"SessionReplay",app_id:c.applicationID,protocol_version:"0",timestamp:y,attributes:(0,k.j6)((0,r.Z)((0,r.Z)((0,r.Z)({},!!this.gzipper&&!!this.u8&&{content_encoding:"gzip"}),b.entityGuid&&{entityGuid:b.entityGuid}),{},{"replay.firstTimestamp":y,"replay.lastTimestamp":m,"replay.nodes":d.length,"session.durationMs":u.session.getDuration(),agentVersion:u.version,session:u.session.state.value,rst:p,hasMeta:e.hasMeta||!1,hasSnapshot:e.hasSnapshot||!1,hasError:e.hasError||!1,isFirstChunk:!1===u.session.state.sessionReplaySentFirstChunk,decompressedBytes:e.payloadBytesEstimation,invalidStylesheetsDetected:O.j.invalidStylesheetsDetected,inlinedAllStylesheets:e.inlinedAllStylesheets,"rrweb.version":w.lF},h&&{"enduser.id":h}),g.J0).substring(1)},body:d}}},{key:"onHarvestFinished",value:function(e){429===e.status&&this.abort(g.Mi.TOO_MANY),this.blocked&&this.scheduler.stopTimer(!0)}},{key:"forceStop",value:function(e){var t,i;e&&this.scheduler.runHarvest(),this.mode=_.IK.OFF,null===(t=this.recorder)||void 0===t||null===(i=t.stopRecording)||void 0===i||i.call(t),this.syncWithSessionManager({sessionReplayMode:this.mode})}},{key:"abort",value:function(){var e,t,i,r,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for((0,M.Z)("SR aborted -- ".concat(s.message)),(0,x.p)(T.xS,["SessionReplay/Abort/".concat(s.sm)],void 0,F.D.metrics,this.ee),this.blocked=!0,this.mode=_.IK.OFF,null===(e=this.recorder)||void 0===e||null===(t=e.stopRecording)||void 0===t||t.call(e),this.syncWithSessionManager({sessionReplayMode:this.mode}),null===(i=this.recorder)||void 0===i||null===(r=i.clearTimestamps)||void 0===r||r.call(i),this.ee.emit("REPLAY_ABORTED");null!==(n=this.recorder)&&void 0!==n&&n.getEvents().events.length;){var n,o,a,l;null===(o=this.recorder)||void 0===o||null===(a=(l=o).clearBuffer)||void 0===a||a.call(l)}}},{key:"syncWithSessionManager",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,S.OP)(this.agentIdentifier).session.write(e)}}]),t}(b.m);(0,f.Z)(A,"featureName",g.t9)},98097:function(e,t,i){i.d(t,{j:function(){return R}});var r=i(74165),s=i(15861),n=i(15671),o=i(43144),a=i(40101),l=i(4942),d=i(72346),u=i(13092),c=i(43889),h=i(86033),p=i(19435),v=i(63711),f=new WeakMap,y=new WeakMap,m=new WeakSet,g=function(){function e(){(0,n.Z)(this,e),(0,a.Z)(this,m),(0,d.Z)(this,f,{writable:!0,value:new WeakSet}),(0,d.Z)(this,y,{writable:!0,value:[]}),(0,l.Z)(this,"invalidStylesheetsDetected",!1),(0,l.Z)(this,"failedToFix",0)}return(0,o.Z)(e,[{key:"evaluate",value:function(){var e=0;if(v.il)for(var t=0;t<Object.keys(document.styleSheets).length;t++)if(!(0,h.Z)(this,f).has(document.styleSheets[t])){(0,h.Z)(this,f).add(document.styleSheets[t]);try{document.styleSheets[t].cssRules}catch(i){if(!document.styleSheets[t].href)return;e++,(0,h.Z)(this,y).push((0,c.Z)(this,m,S).call(this,document.styleSheets[t]))}}return e&&(this.invalidStylesheetsDetected=!0),e}},{key:"fix",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all((0,h.Z)(this,y));case 2:return(0,u.Z)(this,y,[]),t=this.failedToFix,this.failedToFix=0,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function S(e){return b.apply(this,arguments)}function b(){return(b=(0,s.Z)((0,r.Z)().mark((function e(t){var i,s,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t&&t.href){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,p.Yu.FETCH.bind(window)(t.href);case 5:if((i=e.sent).ok){e.next=9;break}return this.failedToFix++,e.abrupt("return");case 9:return e.next=11,i.text();case 11:return s=e.sent,e.prev=12,n=new CSSStyleSheet,e.next=16,n.replace(s);case 16:Object.defineProperty(t,"cssRules",{get:function(){return n.cssRules}}),Object.defineProperty(t,"rules",{get:function(){return n.rules}}),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(12),Object.defineProperty(t,"cssText",{get:function(){return s}}),this.failedToFix++;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(2),this.failedToFix++;case 29:case"end":return e.stop()}}),e,this,[[2,26],[12,20]])})))).apply(this,arguments)}var R=new g}}]);
//# sourceMappingURL=session_replay-aggregate.825a63fd.chunk.js.map