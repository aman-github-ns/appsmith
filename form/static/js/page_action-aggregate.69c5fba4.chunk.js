"use strict";(self.webpackChunkappsmith=self.webpackChunkappsmith||[]).push([[8078],{56777:function(t,e,n){n.d(e,{o:function(){return m}});var r=n(93433),i=n(15671),s=n(43144),a=n(82963),o=n(78814),u=n(61120),d=n(97326),c=n(60136),l=n(75284),h=n(9831),v=n(19198),f=n(99712),p=n(73198);var m=function(t){function e(t,n,r){var s,c,l,h,m;return(0,i.Z)(this,e),l=this,h=e,m=[r],h=(0,u.Z)(h),(c=(0,a.Z)(l,(0,o.Z)()?Reflect.construct(h,m||[],(0,u.Z)(l).constructor):h.apply(l,m))).endpoint=t,c.opts=n||{},c.started=!1,c.timeoutHandle=null,c.aborted=!1,c.harvest=new v.M(c.sharedContext),(0,f.L)(c.unload.bind((0,d.Z)(c))),null===(s=c.sharedContext)||void 0===s||s.ee.on(p.wO.RESET,(function(){return c.runHarvest({forceNoRetry:!0})})),c}return(0,c.Z)(e,t),(0,s.Z)(e,[{key:"unload",value:function(){this.aborted||(this.opts.onUnload&&this.opts.onUnload(),this.runHarvest({unload:!0}))}},{key:"startTimer",value:function(t,e){this.interval=t,this.started=!0,this.scheduleHarvest(null!=e?e:this.interval)}},{key:"stopTimer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.aborted=t,this.started=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}},{key:"scheduleHarvest",value:function(t,e){var n=this;this.timeoutHandle||(null==t&&(t=this.interval),this.timeoutHandle=setTimeout((function(){n.timeoutHandle=null,n.runHarvest(e)}),1e3*t))}},{key:"runHarvest",value:function(t){var e=this;if(!this.aborted){var n,i,s=function(n){null!==t&&void 0!==t&&t.forceNoRetry&&(n.retry=!1),e.onHarvestFinished(t,n)},a=[];if(this.opts.getPayload){if(!(n=l.qD({isFinalHarvest:null===t||void 0===t?void 0:t.unload})))return!1;var o=!(null!==t&&void 0!==t&&t.unload)&&n===l.Be;if(!(i=this.opts.getPayload({retry:o,opts:t})))return void(this.started&&this.scheduleHarvest());i="[object Array]"===Object.prototype.toString.call(i)?i:[i],a.push.apply(a,(0,r.Z)(i))}var u=function(t){return e.harvest.sendX(t)};a.length?u=this.opts.raw?function(t){return e.harvest._send(t)}:function(t){return e.harvest.send(t)}:a.push(void 0),a.forEach((function(r){u({endpoint:e.endpoint,payload:r,opts:t,submitMethod:n,cbFinished:s,customUrl:e.opts.customUrl,raw:e.opts.raw})})),this.started&&this.scheduleHarvest()}}},{key:"onHarvestFinished",value:function(t,e){if(this.opts.onFinished&&this.opts.onFinished(e),e.sent&&e.retry){var n=e.delay||this.opts.retryDelay;this.started&&n?(clearTimeout(this.timeoutHandle),this.timeoutHandle=null,this.scheduleHarvest(n,t)):!this.started&&n&&this.scheduleHarvest(n,t)}}}]),e}(h.w)},99712:function(t,e,n){n.d(e,{L:function(){return u}});var r=n(37762),i=n(98841),s=n(63711),a=n(73087);if(s.v6){s._A.cleanupTasks=[];var o=s._A.close;s._A.close=function(){var t,e=(0,r.Z)(s._A.cleanupTasks);try{for(e.s();!(t=e.n()).done;){(0,t.value)()}}catch(n){e.e(n)}finally{e.f()}o()}}function u(t){s.il?((0,a.N)(t,!0),(0,i.bP)("pagehide",t)):s.v6&&s._A.cleanupTasks.push(t)}},34336:function(t,e,n){n.r(e),n.d(e,{Aggregate:function(){return k}});var r=n(29439),i=n(15671),s=n(43144),a=n(82963),o=n(78814),u=n(61120),d=n(97326),c=n(60136),l=n(4942),h=n(44567),v=n(17610),f=n(68295),p=n(56777),m=n(69292),y=n(19435),H=n(77211),g=n(63711),b=n(14415),Z=n(21782);var k=function(t){function e(t,n){var s,c,l,h,v;return(0,i.Z)(this,e),l=this,h=e,v=[t,n,H.t],h=(0,u.Z)(h),s=(0,a.Z)(l,(0,o.Z)()?Reflect.construct(h,v||[],(0,u.Z)(l).constructor):h.apply(l,v)),c=(0,d.Z)(s),s.eventsPerMinute=240,s.harvestTimeSeconds=(0,y.Mt)(s.agentIdentifier,"page_action.harvestTimeSeconds")||(0,y.Mt)(s.agentIdentifier,"ins.harvestTimeSeconds")||30,s.eventsPerHarvest=s.eventsPerMinute*s.harvestTimeSeconds/60,s.referrerUrl=void 0,s.currentEvents=void 0,s.events=[],s.att=(0,y.C5)(s.agentIdentifier).jsAttributes,g.il&&document.referrer&&(s.referrerUrl=(0,m.f)(document.referrer)),(0,f.X)("api-addPageAction",(function(){var t;return(t=c).addPageAction.apply(t,arguments)}),s.featureName,s.ee),s.waitForFlags(["ins"]).then((function(t){if((0,r.Z)(t,1)[0]){var e=new p.o("ins",{onFinished:function(){var t;return(t=c).onHarvestFinished.apply(t,arguments)}},(0,d.Z)(s));e.harvest.on("ins",(function(){var t;return(t=c).onHarvestStarted.apply(t,arguments)})),e.startTimer(s.harvestTimeSeconds,0),s.drain()}else s.blocked=!0,(0,Z.o5)(s.agentIdentifier,s.featureName)})),s}return(0,c.Z)(e,t),(0,s.Z)(e,[{key:"onHarvestStarted",value:function(t){var e=(0,y.C5)(this.agentIdentifier),n={qs:{ua:e.userAttributes,at:e.atts},body:{ins:this.events}};return t.retry&&(this.currentEvents=this.events),this.events=[],n}},{key:"onHarvestFinished",value:function(t){t&&t.sent&&t.retry&&this.currentEvents&&(this.events=this.events.concat(this.currentEvents),this.currentEvents=null)}},{key:"addPageAction",value:function(t,e,n){if(!(this.events.length>=this.eventsPerHarvest||this.blocked)){var r,i,s={};g.il&&window.document.documentElement&&(r=window.document.documentElement.clientWidth,i=window.document.documentElement.clientHeight);var a=(0,y.OP)(this.agentIdentifier),o={timestamp:a.timeKeeper.convertRelativeTimestamp(t),timeSinceLoad:t/1e3,browserWidth:r,browserHeight:i,referrerUrl:this.referrerUrl,currentUrl:(0,m.f)(""+location),pageUrl:(0,m.f)(a.origin),eventType:"PageAction"};(0,h.D)(o,u),(0,h.D)((0,y.C5)(this.agentIdentifier).jsAttributes,u),n&&"object"===typeof n&&(0,h.D)(n,u),s.actionName=e||"",this.events.push(s)}function u(t,e){s[t]=e&&"object"===typeof e?(0,v.P)(e):e}}}]),e}(b.m);(0,l.Z)(k,"featureName",H.t)}}]);
//# sourceMappingURL=page_action-aggregate.69c5fba4.chunk.js.map